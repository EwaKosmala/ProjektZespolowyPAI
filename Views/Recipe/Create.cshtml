@model lab1_gr1.ViewModels.RecipeVM.CreateRecipeVM

@{
    ViewData["Title"] = "Dodaj przepis";
}

<h2>Dodaj przepis</h2>

<form asp-action="Create" method="post">
    <div>
        <label for="Name">Nazwa przepisu</label>
        <input asp-for="Name" />
    </div>

    <div>
        <label for="Description">Opis</label>
        <textarea asp-for="Description"></textarea>
    </div>

    <div>
        <label for="Instructions">Instrukcje</label>
        <textarea asp-for="Instructions"></textarea>
    </div>

    <h3>Składniki</h3>
    <div id="ingredients-container">
        @for (int i = 0; i < Model.Ingredients.Count; i++)
        {
            <div class="ingredient-row">
                <input name="Ingredients[@i].IngredientName" value="@Model.Ingredients[i].IngredientName" placeholder="Nazwa składnika" />
                <input name="Ingredients[@i].Quantity" value="@Model.Ingredients[i].Quantity" placeholder="Ilość" />
                <button type="button" class="remove-ingredient">Usuń</button>
            </div>
        }
    </div>

    <button type="button" id="add-ingredient-btn" class="btn btn-primary btn-sm">Dodaj składnik</button>

    <h3 class="mt-4">Dni tygodnia</h3>
    <div class="form-check">
        @for (int i = 0; i < 7; i++)
        {
            var day = i + 1;
            var dayName = day switch
            {
                1 => "Poniedziałek",
                2 => "Wtorek",
                3 => "Środa",
                4 => "Czwartek",
                5 => "Piątek",
                6 => "Sobota",
                7 => "Niedziela",
                _ => ""
            };
            <div class="form-check form-check-inline">
                <input type="checkbox"
                       id="day_@day"
                       name="SelectedDays"
                       value="@day"
                @(Model.SelectedDays.Contains(day) ? "checked" : "") />
                <label class="form-check-label" for="day_@day">@dayName</label>
            </div>
        }
    </div>





    <div style="margin-top:10px;">
        <button type="submit" class="btn btn-success">Zapisz przepis</button>
        <a asp-action="Index" class="btn btn-secondary">Anuluj</a>
    </div>
</form>

@section Scripts {
    <script>
        let ingredientIndex = @Model.Ingredients.Count;

        // Funkcja do przepisania indeksów w inputach po zmianach
        function reindexIngredients() {
            const rows = document.querySelectorAll('#ingredients-container .ingredient-row');
            rows.forEach((row, index) => {
                row.querySelector('input[name$=".IngredientName"]').name = `Ingredients[${index}].IngredientName`;
                row.querySelector('input[name$=".Quantity"]').name = `Ingredients[${index}].Quantity`;
            });
        }

        // Obsługa przycisku "Dodaj składnik"
        document.getElementById('add-ingredient-btn').addEventListener('click', () => {
            const container = document.getElementById('ingredients-container');
            const newRow = document.createElement('div');
            newRow.classList.add('ingredient-row');
            newRow.innerHTML = `
                <input name="Ingredients[${ingredientIndex}].IngredientName" placeholder="Nazwa składnika" />
                <input name="Ingredients[${ingredientIndex}].Quantity" placeholder="Ilość" />
                <button type="button" class="remove-ingredient">Usuń</button>
            `;
            container.appendChild(newRow);

            // Dodaj event dla nowego przycisku usuń
            newRow.querySelector('.remove-ingredient').addEventListener('click', () => {
                newRow.remove();
                reindexIngredients(); // przepisz indeksy po usunięciu
            });

            ingredientIndex++;
        });

        // Obsługa istniejących przycisków "Usuń" w HTML
        document.querySelectorAll('.remove-ingredient').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.parentElement.remove();
                reindexIngredients(); // przepisz indeksy po usunięciu
            });
        });
    </script>
}
