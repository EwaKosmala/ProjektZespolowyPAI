@model lab1_gr1.ViewModels.RecipeVM.CreateRecipeVM

@{
    ViewData["Title"] = "Dodaj przepis";
}

<h2>Dodaj przepis</h2>

<form asp-action="Create" method="post">
    <div>
        <label for="Name">Nazwa przepisu</label>
        <input asp-for="Name" />
    </div>

    <div>
        <label for="Description">Opis</label>
        <textarea asp-for="Description"></textarea>
    </div>

    <div>
        <label for="Instructions">Instrukcje</label>
        <textarea asp-for="Instructions"></textarea>
    </div>

    <h3>Składniki</h3>
    <table class="table" id="ingredients-table">
        <thead>
            <tr>
                <th>Składnik</th>
                <th>Ilość</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Ingredients.Count; i++)
            {
                <tr>
                    <td>
                        <input name="Ingredients[@i].IngredientName" value="@Model.Ingredients[i].IngredientName" />
                    </td>
                    <td>
                        <input name="Ingredients[@i].Quantity" value="@Model.Ingredients[i].Quantity" />
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm remove-ingredient">Usuń</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <button type="button" id="add-ingredient-btn" class="btn btn-primary btn-sm">Dodaj składnik</button>

    <h3 class="mt-4">Dni tygodnia</h3>
    <div class="form-check">
        @for (int i = 0; i < 7; i++)
        {
            var day = i + 1;
            var dayName = day switch
            {
                1 => "Poniedziałek",
                2 => "Wtorek",
                3 => "Środa",
                4 => "Czwartek",
                5 => "Piątek",
                6 => "Sobota",
                7 => "Niedziela",
                _ => ""
            };
            <div class="form-check form-check-inline">
                <input type="checkbox"
                       id="day_@day"
                       name="SelectedDays"
                       value="@day"
                @(Model.SelectedDays.Contains(day) ? "checked" : "") />
                <label class="form-check-label" for="day_@day">@dayName</label>
            </div>
        }
    </div>





    <div style="margin-top:10px;">
        <button type="submit" class="btn btn-success">Zapisz przepis</button>
        <a asp-action="Index" class="btn btn-secondary">Anuluj</a>
    </div>
</form>

@section Scripts {
    <script>
        let ingredientIndex = @Model.Ingredients.Count;

        document.getElementById('add-ingredient-btn').addEventListener('click', () => {
            const tableBody = document.querySelector('#ingredients-table tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input name="Ingredients[${ingredientIndex}].IngredientName" placeholder="Nazwa składnika" /></td>
                <td><input name="Ingredients[${ingredientIndex}].Quantity" placeholder="Ilość" /></td>
                <td><button type="button" class="btn btn-danger btn-sm remove-ingredient">Usuń</button></td>
            `;
            tableBody.appendChild(newRow);

            newRow.querySelector('.remove-ingredient').addEventListener('click', () => {
                newRow.remove();
            });

            ingredientIndex++;
        });

        document.querySelectorAll('.remove-ingredient').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('tr').remove();
            });
        });
    </script>
}
